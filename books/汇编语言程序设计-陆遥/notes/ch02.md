---
title: "第二章 8086 宏汇编语言的源程序组成"
category:
 - Programming
tag:
 - Assembly
---

## 1. 汇编语言的语句结构

格式如下：

`[名字项]	操作项	[操作数项]	[;注释项]`

其中 [ ] 为可选项。

### 1.1 分类

汇编语言语句可以分为三类：

1. 伪指令
2. 指令
3. 宏指令

### 1.2 名字项

符合特定规则的字符串，最大长度不超过 31 个字符。组成规则：

- 26 个英文字符
- 数字
- 符号
- 不可以数字开头

### 1.3 操作项

具体的指令。

### 1.4 操作数项

1. 常量
   - 数值常量：
     十进制（D 或 无后缀）
     二进制（B）
     八进制（O）
     十六进制（H，以字符开头需添加 0 前缀）
   - 字符串常量：以 `‘’` 或 `“”` 包裹的字符
2. 变量
3. 寄存器
4. 指令标号和过程名
5. 段名
6. 表达式
   只能包含已知量，不能出现动态确定的量。
   - 算数运算
     +、-、\*、/ 和 MOD
   - 逻辑运算
     AND、OR、XOR 和 NOT
   - 关系运算
     EQ、NE、GT、LT、GE 和 LE
   - 属性运算
     OFFSET、PTR、SHORT 等
7. 注释项
   以`;` 开头。

## 2. 常用伪指令

### 2.1 处理器选择

- .8086
- .286/.386/.486/.586
- .286P/.386P/.486P/.586P （保护模式）

### 2.2 段定义

```
段名 SEGMENT [定位类型] [组合类型] [类别]
	... ;具体内容
段名 ENDS
```

1. SEGMENT 段定义
2. ENDS 段定义结束
3. 定位类型：
   - PARA - 段首地址必须被 **16 整除**（默认类型）
   - BYTE - 段首地址可为**任意地址**
   - WORD - 段首地址必须为**偶数**
   - DWORD - 段首地址必须能被 4 整除
   - PAGE - 段首地址必须能被 256 整除
4. 组合类型：
   - PUBLIC - 将多个模块的 PUBLIC 的同名、同类型的段依次连接成一个段，总容量不超过 64 KB
   - STACK - 与 PUBLIC 相同，仅作用于堆栈段
   - COMMON - 将多个模块的 COMMON 的同名、同类型的段组合成一个段，容量为多段中的最大者，段地址相同，按连接顺序在空间内相互覆盖
   - 若缺省组合类型，表示不与任何段组合
5. 类别：
   为任意合法字符串，必须使用单引号。作用于组合中， 类别相同的段可进行组合。

### 2.3 ASSUME

```
ASSUME 段寄存器:段名 [, 段寄存器:段名]
```

用于指定**段寄存器**和**段**之间的联系。

### 2.4 源程序结束

```
END [指令标号] 
```

上述的指令标号为**程序入口**指令的标号，用于指出程序的入口。

### 2.5 变量定义

```
[变量名] 类型定义操作符 数据项或表达式
```

- 类型定义:
  DB - 字节类型
  DW - 字类型
  DD - 双字
  DQ - 四字
  DT - 十字

### 2.6 重复操作符 DUP

```
重复次数 DUP (数据项或表达式)
```

```assembly
ARR1 DB 100 DUP (?) ;为字节类型数组 ARR1 分配 100 个元素的空间
ARR2 DW 50 DUP (0) ; 为字类型数组 ARR2 分配 50 个元素的空间, 并置为 0 
ARR3 DB 5 DUP (12H, 86H) ;分配并赋初值
ARR4 DB 65H, 3 DUP (4AH, 05H), 30H 
```

### 2.7 属性表达式

1. OFFSET
   ```
   OFFSET 变量或标号
   ```

   获取变量或标号的**段内偏移地址**

2. SEG 
   ```
   SEG  变量或标号
   ```

   获取变量或标号的**段地址**

3. PTR
   重新指定变量, 标号或地址表达式的访问类型

   ```
   新类型 PTR  变量/标号/地址表达式
   ```

   类型:
   变量类型

   - BYTE
   - WORD
   - DWORD

   标号类型

   - NEAR - 近类型
   - FAR - 远类型

### 2.8 替代符定义

**`EQU/=`**

```
替代符 EQU 表达式
```

使用替代符代替原表达式以提高可读性

```assembly
C1 EQU 15
C2 EQU C1-2
```

使用 `=` 和 `EQU` 相同

### 2.9 段内偏移指针

**`使用段内偏移指针 $`**

动态指出段内下一个可分配的存储单元的偏移地址.

```assembly
DSEG SEGMENT
	D1 DB 1,2,3
	N1 = $-D1 ; N1 为 D1 的元素个数
	D2 DW 1023H, 4567H
	N2 = ($-D2)/2 ;N2 为 D2 元素个数, $-D2 表示占用字节数
DSEG ENDS
```

**设置段内偏移指针 ORG**

```
ORG 常量表达式
```

```assembly
DSEG SEGMENT
	D1 DB 5 DUP(?)
	ORG 100H
	D2 DW 1234H, 4567H ;此处因为手动设置了段内偏移地址,所以 D2 从 100H 开始
DSEG ENDS
```

由于 ORG 指令破环了段内偏移指针的正常变化规律, 故只在特殊情况下使用.

### 2.10 过程定义

过程也称为子程序, 格式如下:

```
过程名 PROC [类型: NEAR/FAR]
	... ; 内容
过程名 ENDP
```

NEAR: 过程和调用程序定义在同一代码段内, 为默认类型.

FAR: 过程与调用程序不在同一代码段内.

### 2.11 宏定义

```
宏指令名 MACRO [形式参数表]
	... ; 宏体
ENDM
```

宏指令经定义后, 即可在程序中使用, 称为宏调用.









